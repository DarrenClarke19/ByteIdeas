<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
  <title>Hike Haven</title>

  <style>
    #map{
      width:80vw;
      height:600px;
      background-color: grey;
    }
    /*header{
    background: url(images/background.jpg);
    background-size: cover;
    background-position: center;
    min-height:1000px;
   }
   @media screen and (max-width:700px){
      header{
        min-height:500px;
      }
   }*/
   body{
    background-color: aliceblue;
   }

   .search-container {
    display: flex;
    align-items: center;
    max-width: 400px;
    margin: 0 auto;
}

#search-input {
    flex: 1;
    padding: 5px;
    border: 1px solid #ccc;
    border-radius: 5px 0 0 5px;
    font-size: 14px;
    padding-right: 20px;
  }
  .hidden-details.show {
      display: block;
    }
  .hidden-details {
      display: none;
      background-color: #f0f0f0; 
      padding: 10px;
      border-radius: 5px; 
      margin-top: 10px; 
  }
  .hidden-details p {
      margin: 5px 0; 
  }
  .card{
    width:440px;
  }
  .card img{
      width:440px;
      height:200px;
  }
  </style>
  
</head>

<body>
  <header>
  <nav class="nav-wraper green">
    <div class="container">
      <a href="index.html" class="brand-logo">Hike Havens</a>
      <a href="#" class="sidenav-trigger" data-target="mobile-links">
        <i class="material-icons">menu</i>
      </a>

    <ul class="right hide-on-med-and-down">
      <li><a href="index.html">HOME</a></li>
      <li><a href="explore.html">HIKES</a></li>
      <li><button id="logoutBtn" class="btn=small green waves-effect waves-light" style="display:none">LOGOUT</button></li>
      <li><a href="#" class="btn-small green waves-effect waves-light">LOGIN</a></li>
    </ul>
  </div>
  </nav>
  </header>
  <ul class="sidenav" id="mobile-links">
    <li><a href="index.html">HOME</a></li>
    <li><a href="about.html">ABOUT</a></li>
  </ul>

    <div class="search-container">
       <input type="text" id="search-input" placeholder="Enter Location">
       <button class="btn waves-effect waves-light green" type="submit" name="action" onclick="searchLocation()">Search
        <i class="material-icons right">search</i>
      </button>
    </div>
      <h2 style="text-align: center;">Map</h2>
      <div class="container" id="map" style="margin-bottom: 50px;"> 
      </div>

      <div class="parallax-container" style="margin-bottom: 170px;">
        <div class="parallax">
            <img src="images/parallax.jpg" alt="" class="responsive-img">
        </div>
      </div>
      <div class="container" id="hikeData">

      </div>
      <script>
        function initMap(){
            map = new google.maps.Map(document.getElementById('map'), {
              center: {lat: 10.676591, lng: -61.260061},
              zoom: 11,
              mapId: 'c320c40ab2398e34'
            });
          //let marker=new google.maps.Marker({position:origin, map:map})

          document.addEventListener('DOMContentLoaded', function() {
          const viewDetailsLinks = document.querySelectorAll('.view-details');

          viewDetailsLinks.forEach(function(link) {
              link.addEventListener('click', function(event) {
              event.preventDefault();
              const card = event.target.closest('.card');
              const hiddenDetails = card.querySelector('.hidden-details');
              hiddenDetails.classList.toggle('show');
            });
          });
        });

          if(navigator.geolocation){
              navigator.geolocation.getCurrentPosition(function(position){
                var pos={
                  lat: position.coords.latitude,
                  lng: position.coords.longitude
                };
              map.setCenter(pos);
              map.setZoom(15);
              var marker = new google.maps.Marker({
                position: pos,
                map: map,
                title: 'Your Location'
              });
              }, 
              function(){
                handleLocationError(true, map.getCenter());
              });
            }else{
              handleLocationError(false, map.getCenter());
            }
          }
          function handleLocationError(browserHasGeolocation, pos){
               var errorMessage=browserHasGeolocation?
              'Error: The Geolocation service failed.' :
              'Error: Your browser doesn\'t support geolocation.';
              console.error(errorMessage);
            }  
            function searchLocation() {
                var input = document.querySelector('#search-input').value;
                var geocoder = new google.maps.Geocoder();
                geocoder.geocode({ 'address': input }, function (results, status) {
                if (status == 'OK') {
                    map.setCenter(results[0].geometry.location);
                    map.setZoom(15);
                } else {
                    alert('Geocode was not successful for the following reason: ' + status);
                  }
                });
             }
             document.addEventListener('DOMContentLoaded', function() {
    async function getData() {
        const response = await fetch('data.json');
        const data = await response.json();
        return data;
    }

    async function displayAll() {
        const state = await getData();
        drawCards(state);
    }

    function drawCards(records) {
        let html = '';
        let result = document.querySelector('#hikeData');
        for (let rec of records) {
            html += `
                <div class="row">
                    <div class="col s12 16">
                        <div class="card">
                            <div class="card-img">
                                <img src="${rec.image}" alt="${rec.name}-img">
                                <a href="#" class="halfway-fab btn-floating red lighten-1 pulse">
                                    <i class="material-icons">favorite</i>
                                </a>
                            </div>
                            <div class="card-content">
                                <span class="card-title">${rec.name}</span>
                            </div>
                            <div class="card-action">
                                <a href="#" class="view-details">More Details</a>
                            </div>
                            <div class="hidden-details">
                                <p>Location: ${rec.location}</p>
                                <p>Length: ${rec.length}</p>
                                <p>Difficulty: ${rec.difficulty}</p>
                                <p>Estimated Time: ${rec.estimated_time}</p>
                            </div>
                        </div>
                        <div class="col s12 16"></div>
                    </div>
                </div>`;
        }
        result.innerHTML = html;

        const viewDetailsLinks = document.querySelectorAll('.view-details');

        viewDetailsLinks.forEach(function(link) {
            link.addEventListener('click', function(event) {
                event.preventDefault();
                const card = event.target.closest('.card');
                const hiddenDetails = card.querySelector('.hidden-details');
                hiddenDetails.classList.toggle('show');
            });
        });
    }

    displayAll();
});
        initMap();
      </script>
    <script>
        $(document).ready(function(){
        // Initialize Google Places Autocomplete on search input
        var input = document.querySelector('#search-input');
        var autocomplete = new google.maps.places.Autocomplete(input);
        autocomplete.bindTo('bounds', map); // Restrict Autocomplete to map bounds
        // Listen for the 'place_changed' event to handle user selection
        autocomplete.addListener('place_changed', function() {
        var place = autocomplete.getPlace();
        if (!place.geometry) {
            // User entered a place not returned by Google
            return;
        }
        // If place has geometry, center the map on the selected place
        if (place.geometry.viewport) {
            map.fitBounds(place.geometry.viewport);
        } else {
            map.setCenter(place.geometry.location);
            map.setZoom(15); // Set a default zoom level
        }
       });
      });
    </script>
  <script async defer src="https://maps.googleapis.com/maps/api/js?AIzaSyBgj40pJo2Itk5sDKEZMbCQC9NTsvMHOU8&callback=initMap&libraries=&v=weekly&map_ids=c320c40ab2398e34"></script>
    <!-- Compiled and minified JavaScript -->
    <script async
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBgj40pJo2Itk5sDKEZMbCQC9NTsvMHOU8&loading=async&libraries=places&callback=initMap">
</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script>
      $(document).ready(function(){
        $('.parallax').parallax();
      })
    </script>
    
    <script>
      
      </script>
</body>

</html>